package com.capgemini.librarymanagementsystemhibernate.controller;

import java.util.Iterator;
import java.util.List;
import java.util.Scanner;

import com.capgemini.librarymanagementsystemhibernate.dto.BookInfo;
import com.capgemini.librarymanagementsystemhibernate.dto.RequestInfo;
import com.capgemini.librarymanagementsystemhibernate.dto.UserInfo;
import com.capgemini.librarymanagementsystemhibernate.exception.LibraryManagementSystemException;
import com.capgemini.librarymanagementsystemhibernate.fatory.LibraryManagementSystemFactory;
import com.capgemini.librarymanagementsystemhibernate.service.LibraryUserService;




public class LibraryManagementSystemController {

	public static void main(String[] args) {

		UserInfo libraryUserBean = LibraryManagementSystemFactory.getUserInfo();
		LibraryUserService lmsService = LibraryManagementSystemFactory.getLibraryUserService();
		BookInfo bookInfo = LibraryManagementSystemFactory.getBookInfo();
		RequestInfo requestInfo = LibraryManagementSystemFactory.getRequestInfo();

		Scanner scanner = new Scanner(System.in);
		int choice;
		int check;
		int userChoice;
		do {
			System.out.println("1.Amin Login");
			System.out.println("2. User Login");
			System.out.println("Enter your choice");
			choice = scanner.nextInt();
			switch (choice) {
			case 1:
				System.out.println("-----------------");
				System.out.println("Enter Admin Email id");
				String emailId = scanner.next();
				System.out.println("Enter Admin password");
				String password = scanner.next();
				try {
					UserInfo userInfo = lmsService.login(emailId, password);
				
					if (userInfo != null) {
						System.out.println("Admin Login Successfull");
						do {
							System.out.println("1. Register");
							System.out.println("2. Search");
							System.out.println("3. Add Book");
							System.out.println("4. Show All Books");
							System.out.println("5. Show Users");
							System.out.println("6. Remove Book");
							System.out.println("7. Show Requests");
							System.out.println("8. Book Issue");
							System.out.println("9. Receive Returned Book");
							System.out.println("0. Exit");

							System.out.println("Enter your choice");
							check = scanner.nextInt();
							switch (check) {
							case 1:
								System.out.println("Enter user id");
								int userId = scanner.nextInt();
								System.out.println("Enter username");
								String name = scanner.next();
								System.out.println("Enter email id");
								String email = scanner.next();
								System.out.println("Enter password");
								String userPassword = scanner.next();
								System.out.println("Enter role");
								String role = scanner.next();
								

								UserInfo user1 = new UserInfo();
								user1.setId(userId);
								user1.setName(name);
								user1.setEmailId(email);
								user1.setPassword(userPassword);
								user1.setRole(role);
								

								boolean res = lmsService.addUser(user1);

								if (res) {
									System.out.println("user registered succesfully");
								} else {
									System.out.println("not registered");
								}
								break;

							case 2:
								System.out.println("Enter Book Id");
								int bookId1=scanner.nextInt();
								BookInfo bookInfo1=lmsService.search(bookId1);
								if(bookInfo1!=null) {
								
								System.out.println("Book Name----->"+bookInfo1.getBookId());
								System.out.println(bookInfo1.getBookName());
								System.out.println(bookInfo1.getAuthor());
								
								}else {
									System.out.println("Book not found");
								}
								break;
							case 3:
								System.out.println("Enter book Id");
								int bookId=scanner.nextInt();
								System.out.println("Enter book Name");
								String bookName=scanner.next();
								System.out.println("Enter author name");
								String authorName=scanner.next();
								System.out.println("Enter publisher name");
								String publisherName=scanner.next();
								System.out.println("Enter Categoty");
								String category=scanner.next();
								BookInfo books=new BookInfo();
								books.setBookId(bookId);
								books.setBookName(bookName);
								books.setAuthor(authorName);
								books.setPublisher(publisherName);
								books.setCategory(category);
								
								boolean result=lmsService.addBook(books);
								if(result) {
									System.out.println("Book is added");
								}else {
									System.out.println("Book is not added");
								}
								

								break;
							case 4:
								try {
									System.out.println("Books present in library are :");
									System.out.println("-------------------------------");

									List<BookInfo> users = lmsService.viewBooks();
									Iterator<BookInfo> iterator = users.iterator();
									while (iterator.hasNext()) {

										BookInfo book = (BookInfo) iterator.next();

										System.out.println("Book id ---------->" + book.getBookId());
										System.out.println("Bookname --------> " + book.getBookName());
										System.out.println("Author name-------->" + book.getAuthor());
										System.out.println("Publisher---------->" + book.getPublisher());
										System.out.println("Category---->" + book.getCategory());
										System.out.println("-----------------------------------------------------");
									}

								} catch (Exception e) {
									System.out.println("No Books present in library");
								}

								break;
							case 5:
								try {
									System.out.println("users in library are :");
									System.out.println("-------------------------------");

									List<UserInfo> users = lmsService.viewUsers();
									Iterator<UserInfo> iterator = users.iterator();
									while (iterator.hasNext()) {

										UserInfo user = (UserInfo) iterator.next();

										System.out.println("user id ---------->" + user.getId());
										System.out.println("Username --------> " + user.getName());
										System.out.println("Email Id-------->" + user.getEmailId());
										System.out.println("Role---------->" + user.getRole());
										System.out.println("No of books---->" + user.getNoOfBooksBorrowed());
										System.out.println("-----------------------------------------------------");
									}

								} catch (Exception e) {
									System.out.println("no users present in library");
								}
								break;

							case 6:
								System.out.println("Enter Book Id");
								int bookId3=scanner.nextInt();
								
								boolean isDeleted=lmsService.removeBook(bookId3);
								if(isDeleted) {
									System.out.println("Book removed from library");
								}else {
									System.out.println("Book cannot be removed");
								}
								
								break;

							case 7:
								try {
									System.out.println("Requests are:");
									System.out.println("-------------------------------");

									List<RequestInfo> request = lmsService.viewRequests();
									Iterator<RequestInfo> iterator = request.iterator();
									while (iterator.hasNext()) {

										RequestInfo requestsInfo = (RequestInfo) iterator.next();

										System.out.println("Request Id------>"+requestsInfo.getId());
										System.out.println("user id ---------->" + requestsInfo.getId());
										System.out.println("Book id --------> " + requestsInfo.getBookId());
										System.out.println("-----------------------------------------------------");
									}

								} catch (Exception e) {
									System.out.println("No requests");
								}
								break;


							}
						} while (check != 0);

					}
				} catch (LibraryManagementSystemException e) {
					System.out.println("Invalid credentails");
				}
				break;
			case 2:
				System.out.println("Enter User email id");
				String email=scanner.next();
				System.out.println("Enter password");
				String userPassword=scanner.next();
				try {
					UserInfo userInfo = lmsService.userLogin(email, userPassword);
					if(userInfo!=null) {
					System.out.println("User logged in");
					do {
						System.out.println("1. Search a Book");
						System.out.println("2. Request a Book");
						System.out.println("3. Return Book");
						System.out.println("0. Exit");
						System.out.println("Enter your choice");
						userChoice = scanner.nextInt();
						switch (userChoice) {
						case 1:
							System.out.println("Enter Book Id");
							int bookId1=scanner.nextInt();
							BookInfo bookInfo1=lmsService.search(bookId1);
							if(bookInfo1!=null) {
							
							System.out.println("Book Name----->"+bookInfo1.getBookId());
							System.out.println(bookInfo1.getBookName());
							System.out.println(bookInfo1.getAuthor());
							
							}else {
								System.out.println("Book not found");
							}
							break;
						case 2:
							System.out.println("Enter user Id");
							int userId=scanner.nextInt();
							System.out.println("Enter book Id");
							int bookId4=scanner.nextInt();
							boolean res=lmsService.bookRequest(userId, bookId4);
							if(res) {
								System.out.println("Request placed to admin");
							}else {
								System.out.println("Request not placed to admin");
							}
							break;

						}
					}while(userChoice!=0);

			}
				}catch(Exception e) {
					System.out.println("Invalid credentails");
				}
			}
			
		} while (true);
	}

}
